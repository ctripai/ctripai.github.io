<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ•°å­¦ç‹å›½å¤§é—¯å…³</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;font-family:"å¾®è½¯é›…é»‘","å¹¼åœ†",sans-serif;}
body {background:linear-gradient(#f9f6e8, #f0ead6);min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px;overflow-x:hidden;}
.game-container {width:90%;max-width:500px;background:#faf6e9;border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,0.15);padding:25px;text-align:center;border:5px solid #ff9800;position:relative;z-index:10;}
.title {color:#e91e63;font-size:32px;margin-bottom:15px;text-shadow:2px 2px 4px rgba(0,0,0,0.1);font-weight:bold;}
.level-info {font-size:20px;color:#2196f3;margin:10px 0;background:#f7f2df;padding:8px;border-radius:10px;}

/* --------------- æ ¸å¿ƒä¼˜åŒ–ï¼šç®—å¼åŠç­”æ¡ˆå®¹å™¨ --------------- */
.question-box {
    font-size: 32px; /* å¢å¤§å­—ä½“ï¼Œæå‡å¯è¯»æ€§ */
    margin: 25px 0;
    padding: 25px 30px;
    background: linear-gradient(135deg, #fff8e1 0%, #fff3cd 100%); /* æ¸å˜èƒŒæ™¯ï¼Œæ›´æœ‰è´¨æ„Ÿ */
    border-radius: 20px;
    border: 3px solid #ffc107;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: nowrap;
    white-space: nowrap;
    overflow: hidden;
    position: relative;
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2); /* è½»å¾®é˜´å½±ï¼Œå¢å¼ºç«‹ä½“æ„Ÿ */
    letter-spacing: 0.5px; /* å­—é—´è·ä¼˜åŒ–ï¼Œæå‡å¯è¯»æ€§ */
}
/* ç®—å¼éƒ¨åˆ†æ ·å¼ */
.question-part {
    color: #333; /* æ·±ç°è‰²ï¼Œæ›´ç¨³é‡ */
    margin-right: 10px;
    line-height: 1; /* è¡Œé«˜ç»Ÿä¸€ï¼Œå¯¹é½æ›´ç²¾å‡† */
}
/* ç­”æ¡ˆæ˜¾ç¤ºåŒºåŸŸä¼˜åŒ– */
.answer-display {
    display: inline-block;
    min-width: 100px; /* å¢å¤§æœ€å°å®½åº¦ï¼Œè¾“å…¥æ›´èˆ’é€‚ */
    font-size: 32px;
    text-align: center;
    margin: 0 5px;
    color: #2e7d32;
    font-weight: bold;
    background: #f1f8e9;
    border-radius: 12px;
    padding: 8px 15px; /* å¢åŠ å†…è¾¹è·ï¼Œæ›´é¥±æ»¡ */
    vertical-align: middle;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); /* å†…é˜´å½±ï¼Œå¢å¼ºè´¨æ„Ÿ */
    transition: all 0.2s ease; /* è¿‡æ¸¡æ•ˆæœï¼Œç”¨äºäº¤äº’åé¦ˆ */
    border: 2px solid transparent; /* é€æ˜è¾¹æ¡†ï¼Œé¿å…åˆ‡æ¢æ—¶ä½ç§» */
}
/* ç­”æ¡ˆè¾“å…¥æ—¶çš„äº¤äº’åé¦ˆ */
.answer-display.has-value {
    border-color: #81c784; /* æœ‰å†…å®¹æ—¶æ˜¾ç¤ºæµ…ç»¿è¾¹æ¡† */
    transform: scale(1.02); /* è½»å¾®æ”¾å¤§ï¼Œå¼ºåŒ–æ“ä½œæ„Ÿ */
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05), 0 2px 6px rgba(144, 238, 144, 0.3);
}
/* ç©ºçŠ¶æ€å ä½ç¬¦ */
.answer-display::placeholder {
    color: #bdbdbd;
    font-weight: normal;
    font-size: 28px;
}

/* --------------- å…¶ä»–æ ·å¼ä¿æŒä¸å˜ --------------- */
.num-keyboard {display:grid;grid-template-columns:repeat(3,1fr);gap:12px;width:280px;margin:25px auto;}
.num-btn {padding:18px 0;font-size:24px;border:none;border-radius:15px;cursor:pointer;color:#fff;font-weight:bold;box-shadow:0 4px 8px rgba(0,0,0,0.2);transition:all 0.2s;}
.num-btn.zero-btn {grid-column: span 2;}
.num-btn:hover {transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,0.25);}
.num-btn:nth-child(1) {background:#e91e63;}
.num-btn:nth-child(2) {background:#9c27b0;}
.num-btn:nth-child(3) {background:#673ab7;}
.num-btn:nth-child(4) {background:#3f51b5;}
.num-btn:nth-child(5) {background:#2196f3;}
.num-btn:nth-child(6) {background:#03a9f4;}
.num-btn:nth-child(7) {background:#00bcd4;}
.num-btn:nth-child(8) {background:#009688;}
.num-btn:nth-child(9) {background:#4caf50;}
.num-btn:nth-child(10) {background:#8bc34a;}
.num-btn:nth-child(11) {background:#ff5722;}
.del-btn {font-size: 22px;}
.btn {padding:12px 30px;font-size:20px;background:#ff9800;color:#fff;border:none;border-radius:15px;cursor:pointer;margin:15px;box-shadow:0 4px 8px rgba(0,0,0,0.2);}
.btn:hover {background:#f57c00;transform:translateY(-2px);}
.score-box {font-size:20px;color:#e91e63;margin:15px 0;font-weight:bold;}
.result {font-size:22px;margin:12px 0;font-weight:bold;}
.success {color:#4caf50;text-shadow:1px 1px 2px rgba(0,0,0,0.1);}
.error {color:#f44336;text-shadow:1px 1px 2px rgba(0,0,0,0.1);}
.hidden {display:none;}
.reward {margin-top:20px;font-size:30px;color:#ffd700;font-weight:bold;text-shadow:0 0 10px #ff9800, 0 0 20px #ff9800, 2px 2px 4px #333;padding:15px;border-radius:10px;background:rgba(255, 152, 0, 0.2);animation: rewardBounce 1s ease-in-out infinite alternate, rewardFlash 0.5s ease-in-out infinite alternate;}
@keyframes rewardBounce {from {transform:scale(1);} to {transform:scale(1.1);}}
@keyframes rewardFlash {from {opacity:1;} to {opacity:0.8;}}
.star {position:absolute;color:#ffd700;font-size:30px;opacity:0;text-shadow:0 0 5px #ff9800;animation:fall 2s linear forwards;z-index:5;}
@keyframes fall {0%{transform:translateY(-50px) rotate(0deg);opacity:1;}100%{transform:translateY(100vh) rotate(360deg);opacity:0;}}
.level-up-popup {
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%) scale(0);
background:#fff;
border:6px solid #ffd700;
border-radius:15px;
box-shadow:0 0 20px rgba(255, 215, 0, 0.6);
padding:20px;
width:320px;
max-width:90vw;
z-index:1000;
text-align:center;
animation:popup 0.8s forwards;
}
@keyframes popup {0%{transform:translate(-50%,-50%) scale(0);}70%{transform:translate(-50%,-50%) scale(1.1);}100%{transform:translate(-50%,-50%) scale(1);}}
.popup-title {
color:#ff9800;
font-size:24px;
margin-bottom:10px;
text-shadow:1px 1px 2px rgba(0,0,0,0.2);
white-space:nowrap;
}
.popup-desc {
color:#333;
font-size:16px;
margin-bottom:12px;
line-height:1.4;
}
.confetti {position:absolute;width:10px;height:30px;opacity:0.8;animation:fallConfetti 3s ease-in-out forwards;z-index:999;}
@keyframes fallConfetti {0%{transform:translateY(-20px) rotate(0deg);opacity:1;}100%{transform:translateY(100vh) rotate(720deg);opacity:0;}}

/* å“åº”å¼é€‚é…ï¼šå°å±å¹•ç¼©å°å­—ä½“ */
@media (max-width: 375px) {
    .question-box {
        font-size: 28px;
        padding: 20px 25px;
    }
    .answer-display {
        font-size: 28px;
        min-width: 80px;
    }
}
</style>
</head>
<body>
<div class="game-container">
<h1 class="title">æ•°å­¦ç‹å›½å¤§é—¯å…³</h1>
<div class="level-info" id="levelText">å½“å‰å…³å¡ï¼š1 åŸå ¡å¤§é—¨</div>
<div class="score-box">ç´¯è®¡æ˜Ÿæ˜Ÿï¼š<span id="score">0</span>é¢—</div>

<!-- ä¼˜åŒ–ç®—å¼å’Œç­”æ¡ˆçš„DOMç»“æ„ï¼Œå¢åŠ ç±»ååŒºåˆ† -->
<div class="question-box">
<span class="question-part" id="questionPart">?</span>
<span class="answer-display" id="answerDisplay" contenteditable="false" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ"></span>
</div>

<div class="num-keyboard">
<button class="num-btn">1</button>
<button class="num-btn">2</button>
<button class="num-btn">3</button>
<button class="num-btn">4</button>
<button class="num-btn">5</button>
<button class="num-btn">6</button>
<button class="num-btn">7</button>
<button class="num-btn">8</button>
<button class="num-btn">9</button>
<button class="num-btn zero-btn">0</button>
<button class="num-btn del-btn" id="delBtn">âŒ«</button>
</div>

<div class="result" id="result"></div>
<div class="reward hidden" id="reward"></div>
</div>

<script>
const questionBank = [
["3Ã—5+6=",21],["23+18=",41],["80-56=",24],["7Ã—4=",28],["45-19+27=",53],["9Ã—2=",18],["6+8Ã—3=",30],["72-45=",27],
["5Ã—7-10=",25],["36+24=",60],["91-28=",63],["8Ã—6+5=",53],["63-17=",46],["22+7Ã—3=",43],["4Ã—9=",36],["54-29+16=",41],
["76-48+35=",63],["9Ã—3+12=",39],["43+29-17=",55],["81-36=",45],["6Ã—5-8=",22],["27+54=",81],["5Ã—8+21=",61],["90-57+23=",56],
["88-49+32=",71],["7Ã—6-15=",27],["38+47-29=",56],["6Ã—9+18=",72],["72-38=",34],["4Ã—8+36=",68],["59+26-41=",44],["8Ã—7-20=",36],
["9Ã—8-36=",36],["65+28-47=",46],["7Ã—9+13=",76],["84-39+25=",70],["5Ã—9+42=",87],["92-56+19=",55],["6Ã—8-12=",36],["45+38-26=",57]
];
const levelNames = ["åŸå ¡å¤§é—¨","èŠ±å›­å°å¾„","æ£®æ—è¿·å®«","æ¹–æ³ŠçŸ³æ¡¥","å®è—å±‹"];
const rewardTexts = [
"è§£é”åŸå ¡å¤§é—¨ï¼è·å¾—ã€Œæ•°å­¦å°æ¢å‘˜ã€ç§°å·âœ¨",
"ç©¿è¿‡èŠ±å›­å°å¾„ï¼ã€Œæ•°å­¦å°æ¢å‘˜ã€è¿›é˜¶å•¦ğŸŒŸ",
"èµ°å‡ºæ£®æ—è¿·å®«ï¼è·å¾—ã€Œæ•°å­¦å°èƒ½æ‰‹ã€ç§°å·ğŸ’«",
"è·¨è¿‡æ¹–æ³ŠçŸ³æ¡¥ï¼ã€Œæ•°å­¦å°èƒ½æ‰‹ã€è¶…å‰å®³ğŸ”¥",
"æ‰“å¼€å®è—å±‹ï¼è·å¾—ã€Œæ•°å­¦å°ç‹è€…ã€ç§°å·ğŸ†ï¼Œè§£é”é‡‘å‹‹ç« ï¼"
];

// æ¸¸æˆæ ¸å¿ƒå˜é‡
let currentLevel = 0, currentQuestion = 0, score = 0, userAnswer = "", isChecking = false;
const totalQuestionsPerLevel = 8, answerDelay = 1200, levelUpDelay = 3000;

// è¯­éŸ³åˆæˆç›¸å…³å˜é‡ï¼ˆè°ƒæ•´å‚æ•°ä½¿å£°éŸ³æ›´æ¸©æŸ”ï¼‰
let speechSynthesis = window.speechSynthesis;
let currentUtterance = null;
let speechSettings = {
    rate: 0.8,
    pitch: 1.2,
    volume: 0.8,
    voice: null
};

// è·å–DOMå…ƒç´ 
const levelText = document.getElementById("levelText");
const questionPart = document.getElementById("questionPart");
const answerDisplay = document.getElementById("answerDisplay");
const result = document.getElementById("result");
const scoreSpan = document.getElementById("score");
const reward = document.getElementById("reward");
const delBtn = document.getElementById("delBtn");
const numBtns = document.querySelectorAll(".num-btn:not(#delBtn)");

// åˆå§‹åŒ–æ¸¸æˆ
function initGame() {
    const qIndex = currentLevel * totalQuestionsPerLevel + currentQuestion;
    if (qIndex >= questionBank.length) return;
    questionPart.innerText = questionBank[qIndex][0];
    result.innerText = "";
    userAnswer = "";
    answerDisplay.innerText = "";
    answerDisplay.classList.remove("has-value"); // ç§»é™¤æœ‰å†…å®¹çš„æ ·å¼
    reward.classList.add("hidden");
    isChecking = false;
}

// é¡µé¢åŠ è½½ååˆå§‹åŒ–
initGame();

// æ•°å­—é”®ç›˜äº‹ä»¶
numBtns.forEach(btn => {
    btn.addEventListener("click", () => {
        if (isChecking) return;
        const num = btn.innerText;
        if (userAnswer === "" && num === "0") return;
        if (userAnswer.length >= 2) return;
        userAnswer += num;
        answerDisplay.innerText = userAnswer;
        answerDisplay.classList.add("has-value"); // æ·»åŠ æœ‰å†…å®¹çš„æ ·å¼
        autoSubmit();
    });
});

// åˆ é™¤æŒ‰é’®äº‹ä»¶
delBtn.addEventListener("click", () => {
    if (isChecking) return;
    userAnswer = userAnswer.slice(0, -1);
    answerDisplay.innerText = userAnswer;
    if (!userAnswer) answerDisplay.classList.remove("has-value"); // æ— å†…å®¹æ—¶ç§»é™¤æ ·å¼
});

// åˆ›å»ºå½©å±‘åŠ¨ç”»
function createConfetti() {
    const colors = ['#ffd700','#ff9800','#ff5722','#e91e63','#9c27b0','#3f51b5'];
    const confettiCount = 150;
    for(let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
        confetti.style.left = `${Math.random()*100}vw`;
        confetti.style.top = `${Math.random()*(-50)}px`;
        confetti.style.width = `${Math.random()*10+5}px`;
        confetti.style.height = `${Math.random()*20+10}px`;
        confetti.style.transform = `rotate(${Math.random()*360}deg)`;
        confetti.style.animationDuration = `${Math.random()*3+2}s`;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 5000);
    }
}

// æ˜¾ç¤ºå…³å¡å‡çº§å¼¹çª—
function showLevelUpPopup() {
    const popup = document.createElement('div');
    popup.className = 'level-up-popup';
    popup.innerHTML = `<h2 class="popup-title">æ­å–œè¿‡å…³ï¼ğŸ‰</h2><p class="popup-desc">${rewardTexts[currentLevel]}</p><p class="popup-desc">å³å°†å‰å¾€ ${levelNames[currentLevel+1]}</p>`;
    document.body.appendChild(popup);
    return popup;
}

// è‡ªåŠ¨æäº¤ç­”æ¡ˆåˆ¤æ–­
function autoSubmit() {
    const qIndex = currentLevel * totalQuestionsPerLevel + currentQuestion;
    const correctAnswer = questionBank[qIndex][1];
    const inputNum = Number(userAnswer);
    
    if (userAnswer.length === String(correctAnswer).length || userAnswer.length === 2) {
        isChecking = true;
        
        if (inputNum === correctAnswer) {
            result.innerText = "ç­”å¯¹å•¦ï¼çœŸæ£’ğŸ‘";
            result.className = "result success";
            score++;
            speakText("ç­”å¯¹å•¦ï¼çœŸæ£’ï¼");
        } else {
            result.innerText = `ç­”é”™å•¦ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯${correctAnswer}ğŸ˜œ`;
            result.className = "result error";
            score = score > 0 ? score - 1 : 0;
            speakText(`ç­”é”™å•¦ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯${correctAnswer}`);
        }
        
        scoreSpan.innerText = score;
        
        if (currentQuestion < totalQuestionsPerLevel - 1) {
            setTimeout(() => {
                currentQuestion++;
                initGame();
            }, answerDelay);
        } else {
            createStarAnimation();
            createConfetti();
            let popup;
            
            if(currentLevel < levelNames.length - 1) {
                popup = showLevelUpPopup();
                speakText(rewardTexts[currentLevel]);
                setTimeout(() => {
                    popup.remove();
                    currentLevel++;
                    currentQuestion = 0;
                    levelText.innerText = `å½“å‰å…³å¡ï¼š${currentLevel + 1} ${levelNames[currentLevel]}`;
                    initGame();
                }, levelUpDelay);
            } else {
                setTimeout(() => {
                    createConfetti();
                    showFinalPopup();
                    speakText("æ­å–œé€šå…³ï¼ä½ æ˜¯æ•°å­¦å°ç‹è€…ï¼");
                }, levelUpDelay);
            }
        }
    }
}

// æ˜Ÿæ˜Ÿæ‰è½åŠ¨ç”»
function createStarAnimation() {
    const starCount = 30;
    for(let i = 0; i < starCount; i++) {
        const star = document.createElement("div");
        star.className = "star";
        star.innerText = "â˜…";
        star.style.left = `${Math.random()*100}vw`;
        star.style.animationDelay = `${Math.random()*3}s`;
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 3000);
    }
}

// æœ€ç»ˆé€šå…³å¼¹çª—
function showFinalPopup() {
    const popup = document.createElement("div");
    popup.className = 'level-up-popup';
    popup.innerHTML = `<h2 class="popup-title">æ­å–œé€šå…³ï¼ğŸ†</h2><p class="popup-desc">ä½ æ˜¯æ•°å­¦å°ç‹è€…ï¼</p><p class="popup-desc">ç´¯è®¡è·å¾— ${score} é¢—æ˜Ÿæ˜Ÿ</p><button class="btn" onclick="this.parentElement.remove()">å¤ªæ£’å•¦ï¼</button>`;
    document.body.appendChild(popup);
}

// è¯­éŸ³åˆæˆåˆå§‹åŒ–
function initSpeechSynthesis() {
    if ('speechSynthesis' in window) {
        speechSynthesis = window.speechSynthesis;
        
        speechSynthesis.onvoiceschanged = function() {
            const voices = speechSynthesis.getVoices();
            const chineseVoices = voices.filter(voice => 
                (voice.lang.includes('zh') || voice.name.includes('Chinese')) && 
                (voice.name.includes('Female') || voice.name.includes('å¥³') || voice.gender === 'female')
            );
            
            if (chineseVoices.length > 0) {
                speechSettings.voice = chineseVoices[0];
            } else {
                const defaultChinese = voices.filter(voice => voice.lang.includes('zh') || voice.name.includes('Chinese'));
                if (defaultChinese.length > 0) {
                    speechSettings.voice = defaultChinese[0];
                }
            }
        };
        
        speechSynthesis.getVoices();
    }
}

// æ’­æŠ¥æ–‡æœ¬
function speakText(text) {
    if (!speechSynthesis) return;
    
    if (currentUtterance) {
        speechSynthesis.cancel(currentUtterance);
    }
    
    currentUtterance = new SpeechSynthesisUtterance(text);
    currentUtterance.rate = speechSettings.rate;
    currentUtterance.pitch = speechSettings.pitch;
    currentUtterance.volume = speechSettings.volume;
    if (speechSettings.voice) {
        currentUtterance.voice = speechSettings.voice;
    }
    
    speechSynthesis.speak(currentUtterance);
}

// åˆå§‹åŒ–è¯­éŸ³
initSpeechSynthesis();
</script>
</body>
</html>
